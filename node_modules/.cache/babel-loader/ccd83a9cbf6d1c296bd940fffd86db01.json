{"ast":null,"code":"var _jsxFileName = \"/Users/josephmuruguru/go/src/github.com/kat-generator/src/components/generate.js\";\nimport React from 'react';\nimport { getKatData } from '../util/dao';\nimport { applyColorPalette, getBackgroundColorMap, redrawFromMatrix, mergeLayers } from '../util/generator-helper';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport class Generator extends React.Component {\n  constructor(props) {\n    super(props);\n    this.canvasRef = /*#__PURE__*/React.createRef();\n    this.state = {\n      Face: {},\n      Accessories: {},\n      Background: {},\n      Merged: null,\n      ImgData: null\n    };\n  }\n\n  _generateKat(e) {\n    e.preventDefault();\n    const data = getKatData();\n    data.then(r => {\n      console.log(\"data in promise\", r);\n      this.setState({\n        Face: r[\"face\"],\n        Accessories: r[\"accessories\"],\n        Background: r[\"background\"]\n      });\n      const face = applyColorPalette(this.state.Face[\"face\"][\"Face\"], this.state.Face[\"palette\"][\"palette\"]);\n      const background = getBackgroundColorMap(this.state.Background[\"background\"][\"Background\"]);\n      const aGroup = {}; // console.log('state accessories', Object.keys(this.state.Accessories))\n\n      Object.keys(this.state.Accessories).forEach(placement => {\n        if (this.state.Accessories[placement]) {\n          // console.log(this.state.Accessories[placement][\"accessory\"][\"accessory\"]);\n          // console.log(this.state.Accessories[placement][\"palette\"][\"palette\"]);\n          aGroup[placement] = applyColorPalette(this.state.Accessories[placement][\"accessory\"][\"accessory\"], this.state.Accessories[placement][\"palette\"][\"palette\"]);\n        }\n      }); // console.log(\"formatted accessories\", aGroup);\n\n      let base = mergeLayers(background, face);\n      let a = Object.values(aGroup).reduce((acc, curr) => {\n        return mergeLayers(acc, curr);\n      });\n      let combo = mergeLayers(base, a);\n      redrawFromMatrix(combo, this.canvasRef.current.getContext(\"2d\"));\n      let imgData = this.canvasRef.current.toDataURL(\"image/png\");\n      console.log(\"converted image data\", imgData);\n      this.setState({\n        Merged: combo,\n        ImgData: imgData\n      });\n    });\n  }\n\n  _generateCanvas() {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      children: /*#__PURE__*/_jsxDEV(\"canvas\", {\n        ref: this.canvasRef,\n        width: 240,\n        height: 240\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 53,\n        columnNumber: 17\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 52,\n      columnNumber: 13\n    }, this);\n  }\n\n  render() {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      children: [/*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: e => this._generateKat(e),\n        children: \"Generate Kat\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 61,\n        columnNumber: 17\n      }, this), this._generateCanvas(), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 63,\n        columnNumber: 17\n      }, this), this.state.Merged && this.state.ImgData ? /*#__PURE__*/_jsxDEV(\"a\", {\n        href: this.state.ImgData,\n        download: true,\n        children: \"Download Kat\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 64,\n        columnNumber: 60\n      }, this) : null]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 60,\n      columnNumber: 13\n    }, this);\n  }\n\n}","map":{"version":3,"sources":["/Users/josephmuruguru/go/src/github.com/kat-generator/src/components/generate.js"],"names":["React","getKatData","applyColorPalette","getBackgroundColorMap","redrawFromMatrix","mergeLayers","Generator","Component","constructor","props","canvasRef","createRef","state","Face","Accessories","Background","Merged","ImgData","_generateKat","e","preventDefault","data","then","r","console","log","setState","face","background","aGroup","Object","keys","forEach","placement","base","a","values","reduce","acc","curr","combo","current","getContext","imgData","toDataURL","_generateCanvas","render"],"mappings":"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","sourcesContent":["import React from 'react';\nimport {getKatData} from '../util/dao';\nimport {applyColorPalette, getBackgroundColorMap, redrawFromMatrix, mergeLayers} from '../util/generator-helper';\n\nexport class Generator extends React.Component {\n    constructor(props) {\n        super(props);\n        this.canvasRef = React.createRef();\n        this.state = {Face: {}, Accessories: {}, Background: {}, Merged: null, ImgData: null}\n    }\n    _generateKat (e) {\n        e.preventDefault();\n        const data = getKatData();\n        data.then(r => {\n            console.log(\"data in promise\", r);\n            this.setState({\n                Face: r[\"face\"],\n                Accessories: r[\"accessories\"],\n                Background: r[\"background\"]\n            });\n\n            const face = applyColorPalette(this.state.Face[\"face\"][\"Face\"],this.state.Face[\"palette\"][\"palette\"])\n            const background = getBackgroundColorMap(this.state.Background[\"background\"][\"Background\"])\n            const aGroup = {}\n            // console.log('state accessories', Object.keys(this.state.Accessories))\n            Object.keys(this.state.Accessories).forEach(placement => {\n                if (this.state.Accessories[placement]) {\n                    // console.log(this.state.Accessories[placement][\"accessory\"][\"accessory\"]);\n                    // console.log(this.state.Accessories[placement][\"palette\"][\"palette\"]);\n                    aGroup[placement] = applyColorPalette(this.state.Accessories[placement][\"accessory\"][\"accessory\"],this.state.Accessories[placement][\"palette\"][\"palette\"] )\n                }\n            });\n            // console.log(\"formatted accessories\", aGroup);\n            let base = mergeLayers(background, face);\n            let a = Object.values(aGroup).reduce((acc, curr) => {\n                return mergeLayers(acc, curr);\n            })\n            let combo = mergeLayers(base, a)\n            redrawFromMatrix(combo, this.canvasRef.current.getContext(\"2d\"));\n\n            let imgData = this.canvasRef.current.toDataURL(\"image/png\");\n            console.log(\"converted image data\", imgData);\n            this.setState({\n                Merged: combo,\n                ImgData: imgData\n            })\n        })\n    }\n\n    _generateCanvas() {\n        return (\n            <div>\n                <canvas ref={this.canvasRef} width={240} height={240} />\n            </div>\n        )\n    }\n\n    render () {\n        return (\n            <div>\n                <button onClick={(e) => this._generateKat(e)}>Generate Kat</button>\n                {this._generateCanvas()}\n                <br/>\n                {this.state.Merged && this.state.ImgData ? <a href={this.state.ImgData} download>Download Kat</a> : null}\n            </div>\n        )\n    }\n}"]},"metadata":{},"sourceType":"module"}