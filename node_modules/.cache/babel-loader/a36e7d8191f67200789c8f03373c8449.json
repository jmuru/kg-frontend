{"ast":null,"code":"import _classCallCheck from\"/Users/josephmuruguru/go/src/github.com/kat-generator/KGF/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/josephmuruguru/go/src/github.com/kat-generator/KGF/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"/Users/josephmuruguru/go/src/github.com/kat-generator/KGF/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/Users/josephmuruguru/go/src/github.com/kat-generator/KGF/node_modules/@babel/runtime/helpers/esm/createSuper\";import React from'react';import{getKatData}from'../util/dao';import{applyColorPalette,getBackgroundColorMap,redrawFromMatrix,mergeLayers}from'../util/generator-helper';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export var Generator=/*#__PURE__*/function(_React$Component){_inherits(Generator,_React$Component);var _super=_createSuper(Generator);function Generator(props){var _this;_classCallCheck(this,Generator);_this=_super.call(this,props);_this.canvasRef=/*#__PURE__*/React.createRef();_this.state={Face:{},Accessories:{},Background:{},Merged:null,ImgData:null};return _this;}_createClass(Generator,[{key:\"_generateKat\",value:function _generateKat(e){var _this2=this;e.preventDefault();var data=getKatData();data.then(function(r){console.log(\"data in promise\",r);_this2.setState({Face:r[\"face\"],Accessories:r[\"accessories\"],Background:r[\"background\"]});var face=applyColorPalette(_this2.state.Face[\"face\"][\"Face\"],_this2.state.Face[\"palette\"][\"palette\"]);var background=getBackgroundColorMap(_this2.state.Background[\"background\"][\"Background\"]);var aGroup={};// console.log('state accessories', Object.keys(this.state.Accessories))\nObject.keys(_this2.state.Accessories).forEach(function(placement){if(_this2.state.Accessories[placement]){// console.log(this.state.Accessories[placement][\"accessory\"][\"accessory\"]);\n// console.log(this.state.Accessories[placement][\"palette\"][\"palette\"]);\naGroup[placement]=applyColorPalette(_this2.state.Accessories[placement][\"accessory\"][\"accessory\"],_this2.state.Accessories[placement][\"palette\"][\"palette\"]);}});// console.log(\"formatted accessories\", aGroup);\nvar base=mergeLayers(background,face);var a=Object.values(aGroup).reduce(function(acc,curr){return mergeLayers(acc,curr);});var combo=mergeLayers(base,a);redrawFromMatrix(combo,_this2.canvasRef.current.getContext(\"2d\"));var imgData=_this2.canvasRef.current.toDataURL(\"image/png\");console.log(\"converted image data\",imgData);_this2.setState({Merged:combo,ImgData:imgData});});}},{key:\"_generateCanvas\",value:function _generateCanvas(){return/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(\"canvas\",{ref:this.canvasRef,width:240,height:240})});}},{key:\"render\",value:function render(){var _this3=this;return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"button\",{onClick:function onClick(e){return _this3._generateKat(e);},children:\"Generate Kat\"}),this._generateCanvas(),/*#__PURE__*/_jsx(\"br\",{}),this.state.Merged&&this.state.ImgData?/*#__PURE__*/_jsx(\"a\",{href:this.state.ImgData,download:true,children:\"Download Kat\"}):null]});}}]);return Generator;}(React.Component);","map":{"version":3,"sources":["/Users/josephmuruguru/go/src/github.com/kat-generator/KGF/src/components/generate.js"],"names":["React","getKatData","applyColorPalette","getBackgroundColorMap","redrawFromMatrix","mergeLayers","Generator","props","canvasRef","createRef","state","Face","Accessories","Background","Merged","ImgData","e","preventDefault","data","then","r","console","log","setState","face","background","aGroup","Object","keys","forEach","placement","base","a","values","reduce","acc","curr","combo","current","getContext","imgData","toDataURL","_generateKat","_generateCanvas","Component"],"mappings":"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","sourcesContent":["import React from 'react';\nimport {getKatData} from '../util/dao';\nimport {applyColorPalette, getBackgroundColorMap, redrawFromMatrix, mergeLayers} from '../util/generator-helper';\n\nexport class Generator extends React.Component {\n    constructor(props) {\n        super(props);\n        this.canvasRef = React.createRef();\n        this.state = {Face: {}, Accessories: {}, Background: {}, Merged: null, ImgData: null}\n    }\n    _generateKat (e) {\n        e.preventDefault();\n        const data = getKatData();\n        data.then(r => {\n            console.log(\"data in promise\", r);\n            this.setState({\n                Face: r[\"face\"],\n                Accessories: r[\"accessories\"],\n                Background: r[\"background\"]\n            });\n\n            const face = applyColorPalette(this.state.Face[\"face\"][\"Face\"],this.state.Face[\"palette\"][\"palette\"])\n            const background = getBackgroundColorMap(this.state.Background[\"background\"][\"Background\"])\n            const aGroup = {}\n            // console.log('state accessories', Object.keys(this.state.Accessories))\n            Object.keys(this.state.Accessories).forEach(placement => {\n                if (this.state.Accessories[placement]) {\n                    // console.log(this.state.Accessories[placement][\"accessory\"][\"accessory\"]);\n                    // console.log(this.state.Accessories[placement][\"palette\"][\"palette\"]);\n                    aGroup[placement] = applyColorPalette(this.state.Accessories[placement][\"accessory\"][\"accessory\"],this.state.Accessories[placement][\"palette\"][\"palette\"] )\n                }\n            });\n            // console.log(\"formatted accessories\", aGroup);\n            let base = mergeLayers(background, face);\n            let a = Object.values(aGroup).reduce((acc, curr) => {\n                return mergeLayers(acc, curr);\n            })\n            let combo = mergeLayers(base, a)\n            redrawFromMatrix(combo, this.canvasRef.current.getContext(\"2d\"));\n\n            let imgData = this.canvasRef.current.toDataURL(\"image/png\");\n            console.log(\"converted image data\", imgData);\n            this.setState({\n                Merged: combo,\n                ImgData: imgData\n            })\n        })\n    }\n\n    _generateCanvas() {\n        return (\n            <div>\n                <canvas ref={this.canvasRef} width={240} height={240} />\n            </div>\n        )\n    }\n\n    render () {\n        return (\n            <div>\n                <button onClick={(e) => this._generateKat(e)}>Generate Kat</button>\n                {this._generateCanvas()}\n                <br/>\n                {this.state.Merged && this.state.ImgData ? <a href={this.state.ImgData} download>Download Kat</a> : null}\n            </div>\n        )\n    }\n}"]},"metadata":{},"sourceType":"module"}