{"ast":null,"code":"var _jsxFileName = \"/Users/josephmuruguru/go/src/github.com/kat-generator/KGF/src/components/generate.js\";\nimport React from 'react';\nimport { getAccessory, getKatData, getPalette } from '../util/dao';\nimport { applyColorPalette, getBackgroundColorMap, redrawFromMatrix, mergeLayers } from '../util/generator-helper';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport class Generator extends React.Component {\n  constructor(props) {\n    super(props);\n    this.canvasRef = /*#__PURE__*/React.createRef();\n    this.state = {\n      Face: {},\n      Accessories: {},\n      Background: {},\n      Merged: null,\n      ImgData: null,\n      ActiveAccessories: []\n    };\n  }\n\n  _redrawAccessory(placement) {\n    this._clearKatAccessory(placement);\n\n    const editCoord = applyColorPalette(this.state.Accessories[placement][\"accessory\"][\"accessory\"], this.state.Accessories[placement][\"palette\"][\"palette\"]);\n    let combo = mergeLayers(this.state.Merged, editCoord);\n    redrawFromMatrix(combo, this.canvasRef.current.getContext(\"2d\"));\n    let imgData = this.canvasRef.current.toDataURL(\"image/png\");\n    this.setState({\n      Merged: combo,\n      ImgData: imgData\n    });\n  }\n\n  _drawInitialKat() {\n    const face = applyColorPalette(this.state.Face[\"face\"][\"Face\"], this.state.Face[\"palette\"][\"palette\"]);\n    const background = getBackgroundColorMap(this.state.Background[\"background\"][\"Background\"]);\n    const aGroup = {};\n    Object.keys(this.state.Accessories).forEach(placement => {\n      if (this.state.Accessories[placement]) {\n        aGroup[placement] = applyColorPalette(this.state.Accessories[placement][\"accessory\"][\"accessory\"], this.state.Accessories[placement][\"palette\"][\"palette\"]);\n      }\n    });\n    let base = mergeLayers(background, face);\n    let ags = Object.values(aGroup);\n    let agk = Object.keys(aGroup);\n    let agsIndex = Math.floor(Math.random() * ags.length);\n    ags.splice(agsIndex, 1);\n    agk.splice(agsIndex, 1);\n    let a; // merged accessory array\n\n    if (ags.length === 1) {\n      a = ags[0];\n    } else {\n      a = ags.reduce((acc, curr) => {\n        return mergeLayers(acc, curr);\n      });\n    }\n\n    let combo = mergeLayers(base, a);\n    redrawFromMatrix(combo, this.canvasRef.current.getContext(\"2d\"));\n    let imgData = this.canvasRef.current.toDataURL(\"image/png\");\n    console.log(\"converted image data\", imgData);\n    this.setState({\n      ActiveAccessories: agk,\n      Merged: combo,\n      ImgData: imgData\n    });\n  }\n\n  _clearKatAccessory(p) {\n    const face = applyColorPalette(this.state.Face[\"face\"][\"Face\"], this.state.Face[\"palette\"][\"palette\"]);\n    const background = getBackgroundColorMap(this.state.Background[\"background\"][\"Background\"]);\n    const aGroup = {};\n    Object.keys(this.state.Accessories).forEach(placement => {\n      if (this.state.Accessories[placement]) {\n        if (placement === p) {\n          aGroup[placement] = [];\n        } else {\n          aGroup[placement] = applyColorPalette(this.state.Accessories[placement][\"accessory\"][\"accessory\"], this.state.Accessories[placement][\"palette\"][\"palette\"]);\n        }\n      }\n    });\n    let base = mergeLayers(background, face);\n    let ags = Object.values(aGroup);\n    let agk = Object.keys(aGroup);\n    let agsIndex = Math.floor(Math.random() * ags.length);\n    ags.splice(agsIndex, 1);\n    agk.splice(agsIndex, 1);\n    let a; // merged accessory array\n\n    if (ags.length === 1) {\n      a = ags[0];\n    } else {\n      a = ags.reduce((acc, curr) => {\n        return mergeLayers(acc, curr);\n      });\n    }\n\n    let combo = mergeLayers(base, a);\n    redrawFromMatrix(combo, this.canvasRef.current.getContext(\"2d\"));\n    let imgData = this.canvasRef.current.toDataURL(\"image/png\");\n    console.log(\"converted image data\", imgData);\n    this.setState({\n      ActiveAccessories: agk,\n      Merged: combo,\n      ImgData: imgData\n    });\n  }\n\n  _generateKat(e) {\n    e.preventDefault();\n    const data = getKatData();\n    data.then(r => {\n      console.log(\"data in promise\", r);\n      this.setState({\n        Face: r[\"face\"],\n        Accessories: r[\"accessories\"],\n        Background: r[\"background\"]\n      });\n\n      this._drawInitialKat();\n    });\n  }\n\n  _generateAccessoryPalette(type, placement) {\n    const data = getPalette(type);\n    data.then(r => {\n      console.log('response', r[\"palette\"]);\n      console.log('response', r[\"type\"]);\n      let ac = this.state.Accessories;\n      ac[placement][\"palette\"][\"palette\"] = r[\"palette\"];\n      this.setState({\n        Accessories: ac\n      });\n\n      this._redrawAccessory(placement);\n    });\n  }\n\n  _generateNewAccessory(e, placement) {\n    e.preventDefault();\n    const data = getAccessory(placement);\n    data.then(r => {\n      // console.log('gna response', r['accessory']['accessory']);\n      let ac = this.state.Accessories;\n      ac[placement][\"accessory\"][\"accessory\"] = r[\"accessory\"]['accessory'];\n      this.setState({\n        Accessories: ac\n      });\n\n      this._redrawAccessory(placement);\n    });\n  }\n\n  _generateCanvas() {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      children: /*#__PURE__*/_jsxDEV(\"canvas\", {\n        ref: this.canvasRef,\n        width: 240,\n        height: 240\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 143,\n        columnNumber: 17\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 142,\n      columnNumber: 13\n    }, this);\n  }\n\n  _handleAccessoryPaletteChange(e, placment) {\n    e.preventDefault();\n\n    this._generateAccessoryPalette(\"accessory\", placment);\n  }\n\n  _generateAPBtns() {\n    let activeAccessories = this.state.ActiveAccessories;\n    let btnRender = activeAccessories.map((item, index) => /*#__PURE__*/_jsxDEV(\"button\", {\n      onClick: e => this._handleAccessoryPaletteChange(e, item),\n      children: `Generate new ${item} accessory palette`\n    }, index, false, {\n      fileName: _jsxFileName,\n      lineNumber: 156,\n      columnNumber: 13\n    }, this));\n    return btnRender;\n  }\n\n  _generateAccessoryBtns() {\n    let activeAccessories = this.state.ActiveAccessories;\n    let btnRender = activeAccessories.map((item, index) => /*#__PURE__*/_jsxDEV(\"button\", {\n      onClick: e => this._generateNewAccessory(e, item),\n      children: `Generate new ${item} accessory`\n    }, index, false, {\n      fileName: _jsxFileName,\n      lineNumber: 164,\n      columnNumber: 13\n    }, this));\n    return btnRender;\n  }\n\n  render() {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      children: [/*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: e => this._generateKat(e),\n        children: \"Generate Kat\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 172,\n        columnNumber: 17\n      }, this), this._generateCanvas(), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 174,\n        columnNumber: 17\n      }, this), this.state.Merged && this.state.ImgData ? /*#__PURE__*/_jsxDEV(\"a\", {\n        href: this.state.ImgData,\n        download: true,\n        children: \"Download Kat\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 175,\n        columnNumber: 60\n      }, this) : null, /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 176,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 177,\n        columnNumber: 17\n      }, this), this.state.Merged && this.state.ImgData ? this._generateAPBtns() : null, /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 179,\n        columnNumber: 17\n      }, this), this.state.Merged && this.state.ImgData ? this._generateAccessoryBtns() : null]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 171,\n      columnNumber: 13\n    }, this);\n  }\n\n}","map":{"version":3,"sources":["/Users/josephmuruguru/go/src/github.com/kat-generator/KGF/src/components/generate.js"],"names":["React","getAccessory","getKatData","getPalette","applyColorPalette","getBackgroundColorMap","redrawFromMatrix","mergeLayers","Generator","Component","constructor","props","canvasRef","createRef","state","Face","Accessories","Background","Merged","ImgData","ActiveAccessories","_redrawAccessory","placement","_clearKatAccessory","editCoord","combo","current","getContext","imgData","toDataURL","setState","_drawInitialKat","face","background","aGroup","Object","keys","forEach","base","ags","values","agk","agsIndex","Math","floor","random","length","splice","a","reduce","acc","curr","console","log","p","_generateKat","e","preventDefault","data","then","r","_generateAccessoryPalette","type","ac","_generateNewAccessory","_generateCanvas","_handleAccessoryPaletteChange","placment","_generateAPBtns","activeAccessories","btnRender","map","item","index","_generateAccessoryBtns","render"],"mappings":"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","sourcesContent":["import React from 'react';\nimport {getAccessory, getKatData, getPalette} from '../util/dao';\nimport {applyColorPalette, getBackgroundColorMap, redrawFromMatrix, mergeLayers} from '../util/generator-helper';\n\nexport class Generator extends React.Component {\n    constructor(props) {\n        super(props);\n        this.canvasRef = React.createRef();\n        this.state = {Face: {}, Accessories: {}, Background: {}, Merged: null, ImgData: null, ActiveAccessories: []}\n    }\n\n    _redrawAccessory (placement) {\n        this._clearKatAccessory(placement);\n        const editCoord = applyColorPalette(this.state.Accessories[placement][\"accessory\"][\"accessory\"],this.state.Accessories[placement][\"palette\"][\"palette\"] )\n        let combo = mergeLayers(this.state.Merged, editCoord)\n        redrawFromMatrix(combo, this.canvasRef.current.getContext(\"2d\"));\n        let imgData = this.canvasRef.current.toDataURL(\"image/png\");\n        this.setState({\n            Merged: combo,\n            ImgData: imgData\n        })\n    }\n\n    _drawInitialKat () {\n        const face = applyColorPalette(this.state.Face[\"face\"][\"Face\"],this.state.Face[\"palette\"][\"palette\"])\n        const background = getBackgroundColorMap(this.state.Background[\"background\"][\"Background\"])\n        const aGroup = {}\n        Object.keys(this.state.Accessories).forEach(placement => {\n            if (this.state.Accessories[placement]) {\n                aGroup[placement] = applyColorPalette(this.state.Accessories[placement][\"accessory\"][\"accessory\"],this.state.Accessories[placement][\"palette\"][\"palette\"] )\n            }\n        });\n        let base = mergeLayers(background, face);\n        let ags = Object.values(aGroup);\n        let agk = Object.keys(aGroup);\n        let agsIndex = Math.floor(Math.random() * ags.length);\n        ags.splice(agsIndex, 1);\n        agk.splice(agsIndex, 1);\n        let a; // merged accessory array\n        if (ags.length === 1) {\n            a = ags[0];\n        } else {\n            a = ags.reduce((acc, curr) => {\n                return mergeLayers(acc, curr);\n            })\n        }\n        let combo = mergeLayers(base, a)\n        redrawFromMatrix(combo, this.canvasRef.current.getContext(\"2d\"));\n\n        let imgData = this.canvasRef.current.toDataURL(\"image/png\");\n        console.log(\"converted image data\", imgData);\n        this.setState({\n            ActiveAccessories: agk,\n            Merged: combo,\n            ImgData: imgData\n        })\n    }\n\n    _clearKatAccessory (p) {\n        const face = applyColorPalette(this.state.Face[\"face\"][\"Face\"],this.state.Face[\"palette\"][\"palette\"])\n        const background = getBackgroundColorMap(this.state.Background[\"background\"][\"Background\"])\n        const aGroup = {}\n        Object.keys(this.state.Accessories).forEach(placement => {\n            if (this.state.Accessories[placement]) {\n                if (placement === p) {\n                    aGroup[placement] = [];\n                } else {\n                    aGroup[placement] = applyColorPalette(this.state.Accessories[placement][\"accessory\"][\"accessory\"],this.state.Accessories[placement][\"palette\"][\"palette\"] )\n                }\n            }\n        });\n        let base = mergeLayers(background, face);\n        let ags = Object.values(aGroup);\n        let agk = Object.keys(aGroup);\n        let agsIndex = Math.floor(Math.random() * ags.length);\n        ags.splice(agsIndex, 1);\n        agk.splice(agsIndex, 1);\n        let a; // merged accessory array\n        if (ags.length === 1) {\n            a = ags[0];\n        } else {\n            a = ags.reduce((acc, curr) => {\n                return mergeLayers(acc, curr);\n            })\n        }\n        let combo = mergeLayers(base, a)\n        redrawFromMatrix(combo, this.canvasRef.current.getContext(\"2d\"));\n\n        let imgData = this.canvasRef.current.toDataURL(\"image/png\");\n        console.log(\"converted image data\", imgData);\n        this.setState({\n            ActiveAccessories: agk,\n            Merged: combo,\n            ImgData: imgData\n        })\n    }\n\n    _generateKat (e) {\n        e.preventDefault();\n        const data = getKatData();\n        data.then(r => {\n            console.log(\"data in promise\", r);\n            this.setState({\n                Face: r[\"face\"],\n                Accessories: r[\"accessories\"],\n                Background: r[\"background\"]\n            });\n            this._drawInitialKat();\n        })\n    }\n\n    _generateAccessoryPalette (type, placement) {\n        const data = getPalette(type);\n        data.then(r => {\n            console.log('response', r[\"palette\"]);\n            console.log('response', r[\"type\"]);\n            let ac = this.state.Accessories;\n            ac[placement][\"palette\"][\"palette\"] = r[\"palette\"];\n            this.setState({\n                Accessories: ac,\n            });\n            this._redrawAccessory(placement);\n        })\n    }\n\n    _generateNewAccessory (e, placement) {\n        e.preventDefault();\n        const data = getAccessory(placement);\n        data.then(r => {\n            // console.log('gna response', r['accessory']['accessory']);\n            let ac = this.state.Accessories;\n            ac[placement][\"accessory\"][\"accessory\"] = r[\"accessory\"]['accessory'];\n            this.setState({\n                Accessories: ac,\n            });\n            this._redrawAccessory(placement);\n        });\n    }\n\n    _generateCanvas() {\n        return (\n            <div>\n                <canvas ref={this.canvasRef} width={240} height={240} />\n            </div>\n        )\n    }\n\n    _handleAccessoryPaletteChange(e, placment) {\n        e.preventDefault();\n        this._generateAccessoryPalette(\"accessory\", placment);\n    }\n\n    _generateAPBtns () {\n        let activeAccessories = this.state.ActiveAccessories;\n        let btnRender = activeAccessories.map((item, index) => (\n            <button key={index} onClick={(e) => this._handleAccessoryPaletteChange(e, item)}>{`Generate new ${item} accessory palette`}</button>\n        ));\n        return btnRender\n    }\n\n    _generateAccessoryBtns () {\n        let activeAccessories = this.state.ActiveAccessories;\n        let btnRender = activeAccessories.map((item, index) => (\n            <button key={index} onClick={(e) => this._generateNewAccessory(e, item)}>{`Generate new ${item} accessory`}</button>\n        ));\n        return btnRender\n    }\n\n    render () {\n        return (\n            <div>\n                <button onClick={(e) => this._generateKat(e)}>Generate Kat</button>\n                {this._generateCanvas()}\n                <br/>\n                {this.state.Merged && this.state.ImgData ? <a href={this.state.ImgData} download>Download Kat</a> : null}\n                <br />\n                <br />\n                {this.state.Merged && this.state.ImgData ? this._generateAPBtns() : null}\n                <br />\n                {this.state.Merged && this.state.ImgData ? this._generateAccessoryBtns() : null}\n            </div>\n        )\n    }\n}"]},"metadata":{},"sourceType":"module"}